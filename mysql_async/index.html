<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Tokio based asynchronous MySql client library for The Rust Programming Language."><title>mysql_async - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-b0742ba02757f159.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="mysql_async" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0 (90b35a623 2024-11-26)" data-channel="1.83.0" data-search-js="search-f0d225181b97f9a4.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-f070b9041d14864c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../mysql_async/index.html">mysql_<wbr>async</a><span class="version">0.34.2</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#installation" title="Installation">Installation</a></li><li><a href="#crate-features" title="Crate Features">Crate Features</a><ul><li><a href="#list-of-features" title="List Of Features">List Of Features</a></li></ul></li><li><a href="#tlsssl-support" title="TLS/SSL Support">TLS/SSL Support</a></li><li><a href="#connection-url-parameters" title="Connection URL parameters">Connection URL parameters</a></li><li><a href="#example" title="Example">Example</a></li><li><a href="#pool" title="Pool">Pool</a></li><li><a href="#transaction" title="Transaction">Transaction</a></li><li><a href="#value" title="`Value`"><code>Value</code></a><ul><li><a href="#fromvalue-trait" title="`FromValue` trait"><code>FromValue</code> trait</a></li></ul></li><li><a href="#mysql-query-protocols" title="MySql query protocols">MySql query protocols</a><ul><li><a href="#text-protocol" title="Text protocol">Text protocol</a></li><li><a href="#binary-protocol-and-prepared-statements" title="Binary protocol and prepared statements.">Binary protocol and prepared statements.</a></li></ul></li><li><a href="#named-parameters" title="Named parameters">Named parameters</a></li><li><a href="#statements" title="Statements">Statements</a></li><li><a href="#local-infile-handlers" title="LOCAL INFILE Handlers">LOCAL INFILE Handlers</a><ul><li><a href="#global-local-infile-handler" title="Global LOCAL INFILE handler">Global LOCAL INFILE handler</a></li><li><a href="#local-local-infile-handler" title="Local LOCAL INFILE handler.">Local LOCAL INFILE handler.</a></li></ul></li><li><a href="#testing" title="Testing">Testing</a></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#macros" title="Macros">Macros</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>mysql_async</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/mysql_async/lib.rs.html#9-656">source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Tokio based asynchronous MySql client library for The Rust Programming Language.</p>
<h2 id="installation"><a class="doc-anchor" href="#installation">§</a>Installation</h2>
<p>The library is hosted on <a href="https://crates.io/crates/mysql_async/">crates.io</a>.</p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
mysql_async = &quot;&lt;desired version&gt;&quot;</code></pre></div><h2 id="crate-features"><a class="doc-anchor" href="#crate-features">§</a>Crate Features</h2>
<p>Default feature set is wide – it includes all default <a href="https://github.com/blackbeam/rust_mysql_common#crate-features"><code>mysql_common</code> features</a>
as well as <code>native-tls</code>-based TLS support.</p>
<h3 id="list-of-features"><a class="doc-anchor" href="#list-of-features">§</a>List Of Features</h3>
<ul>
<li>
<p><code>minimal</code> – enables only necessary features (at the moment the only necessary feature
is <code>flate2</code> backend). Enables:</p>
<ul>
<li>`flate2/zlib“</li>
</ul>
<p><strong>Example:</strong></p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
mysql_async = { version = &quot;*&quot;, default-features = false, features = [&quot;minimal&quot;]}</code></pre></div></li>
<li>
<p><code>minimal-rust</code> - same as <code>minimal</code> but rust-based flate2 backend is chosen. Enables:</p>
<ul>
<li><code>flate2/rust_backend</code></li>
</ul>
</li>
<li>
<p><code>default</code> – enables the following set of features:</p>
<ul>
<li><code>minimal</code></li>
<li><code>native-tls-tls</code></li>
<li><code>bigdecimal</code></li>
<li><code>rust_decimal</code></li>
<li><code>time</code></li>
<li><code>frunk</code></li>
<li><code>binlog</code></li>
</ul>
</li>
<li>
<p><code>default-rustls</code> – same as default but with <code>rustls-tls</code> instead of <code>native-tls-tls</code>.</p>
<p><strong>Example:</strong></p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
mysql_async = { version = &quot;*&quot;, default-features = false, features = [&quot;default-rustls&quot;] }</code></pre></div></li>
<li>
<p><code>native-tls-tls</code> – enables <code>native-tls</code>-based TLS support <em>(conflicts with <code>rustls-tls</code>)</em></p>
<p><strong>Example:</strong></p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
mysql_async = { version = &quot;*&quot;, default-features = false, features = [&quot;native-tls-tls&quot;] }
</code></pre></div></li>
<li>
<p><code>rustls-tls</code> – enables <code>native-tls</code>-based TLS support <em>(conflicts with <code>native-tls-tls</code>)</em></p>
<p><strong>Example:</strong></p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
mysql_async = { version = &quot;*&quot;, default-features = false, features = [&quot;rustls-tls&quot;] }
</code></pre></div></li>
<li>
<p><code>tracing</code> – enables instrumentation via <code>tracing</code> package.</p>
<p>Primary operations (<code>query</code>, <code>prepare</code>, <code>exec</code>) are instrumented at <code>INFO</code> level.
Remaining operations, incl. <code>get_conn</code>, are instrumented at <code>DEBUG</code> level.
Also at <code>DEBUG</code>, the SQL queries and parameters are added to the <code>query</code>, <code>prepare</code>
and <code>exec</code> spans. Also some internal queries are instrumented at <code>TRACE</code> level.</p>
<p><strong>Example:</strong></p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
mysql_async = { version = &quot;*&quot;, features = [&quot;tracing&quot;] }</code></pre></div></li>
<li>
<p><code>binlog</code> - enables binlog-related functionality. Enables:</p>
<ul>
<li>`mysql_common/binlog“</li>
</ul>
</li>
</ul>
<h4 id="proxied-features"><a class="doc-anchor" href="#proxied-features">§</a>Proxied features</h4>
<ul>
<li><code>derive</code> – enables <code>mysql_common/derive</code> feature</li>
<li><code>chrono</code> = enables <code>mysql_common/chrono</code> feature</li>
<li><code>time</code> = enables <code>mysql_common/time</code> feature</li>
<li><code>bigdecimal</code> = enables <code>mysql_common/bigdecimal</code> feature</li>
<li><code>rust_decimal</code> = enables <code>mysql_common/rust_decimal</code> feature</li>
<li><code>frunk</code> = enables <code>mysql_common/frunk</code> feature</li>
</ul>
<h2 id="tlsssl-support"><a class="doc-anchor" href="#tlsssl-support">§</a>TLS/SSL Support</h2>
<p>SSL support comes in two flavors:</p>
<ol>
<li>
<p>Based on native-tls – this is the default option, that usually works without pitfalls
(see the <code>native-tls-tls</code> crate feature).</p>
</li>
<li>
<p>Based on rustls – TLS backend written in Rust (see the <code>rustls-tls</code> crate feature).</p>
<p>Please also note a few things about rustls:</p>
<ul>
<li>it will fail if you’ll try to connect to the server by its IP address,
hostname is required;</li>
<li>it, most likely, won’t work on windows, at least with default server certs,
generated by the MySql installer.</li>
</ul>
</li>
</ol>
<h2 id="connection-url-parameters"><a class="doc-anchor" href="#connection-url-parameters">§</a>Connection URL parameters</h2>
<p>There is a set of url-parameters supported by the driver (see documentation on <a href="struct.Opts.html" title="struct mysql_async::Opts"><code>Opts</code></a>).</p>
<h2 id="example"><a class="doc-anchor" href="#example">§</a>Example</h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>mysql_async::prelude::<span class="kw-2">*</span>;

<span class="attr">#[derive(Debug, PartialEq, Eq, Clone)]
</span><span class="kw">struct </span>Payment {
    customer_id: i32,
    amount: i32,
    account_name: <span class="prelude-ty">Option</span>&lt;String&gt;,
}

<span class="attr">#[tokio::main]
</span><span class="kw">async fn </span>main() -&gt; <span class="prelude-ty">Result</span>&lt;()&gt; {
    <span class="kw">let </span>payments = <span class="macro">vec!</span>[
        Payment { customer_id: <span class="number">1</span>, amount: <span class="number">2</span>, account_name: <span class="prelude-val">None </span>},
        Payment { customer_id: <span class="number">3</span>, amount: <span class="number">4</span>, account_name: <span class="prelude-val">Some</span>(<span class="string">"foo"</span>.into()) },
        Payment { customer_id: <span class="number">5</span>, amount: <span class="number">6</span>, account_name: <span class="prelude-val">None </span>},
        Payment { customer_id: <span class="number">7</span>, amount: <span class="number">8</span>, account_name: <span class="prelude-val">None </span>},
        Payment { customer_id: <span class="number">9</span>, amount: <span class="number">10</span>, account_name: <span class="prelude-val">Some</span>(<span class="string">"bar"</span>.into()) },
    ];

    <span class="kw">let </span>database_url = <span class="comment">/* ... */

    </span><span class="kw">let </span>pool = mysql_async::Pool::new(database_url);
    <span class="kw">let </span><span class="kw-2">mut </span>conn = pool.get_conn().<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Create a temporary table
    </span><span class="string">r"CREATE TEMPORARY TABLE payment (
        customer_id int not null,
        amount int not null,
        account_name text
    )"</span>.ignore(<span class="kw-2">&amp;mut </span>conn).<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Save payments
    </span><span class="string">r"INSERT INTO payment (customer_id, amount, account_name)
      VALUES (:customer_id, :amount, :account_name)"
        </span>.with(payments.iter().map(|payment| <span class="macro">params!</span> {
            <span class="string">"customer_id" </span>=&gt; payment.customer_id,
            <span class="string">"amount" </span>=&gt; payment.amount,
            <span class="string">"account_name" </span>=&gt; payment.account_name.as_ref(),
        }))
        .batch(<span class="kw-2">&amp;mut </span>conn)
        .<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Load payments from the database. Type inference will work here.
    </span><span class="kw">let </span>loaded_payments = <span class="string">"SELECT customer_id, amount, account_name FROM payment"
        </span>.with(())
        .map(<span class="kw-2">&amp;mut </span>conn, |(customer_id, amount, account_name)| Payment { customer_id, amount, account_name })
        .<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Dropped connection will go to the pool
    </span>drop(conn);

    <span class="comment">// The Pool must be disconnected explicitly because
    // it's an asynchronous operation.
    </span>pool.disconnect().<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="macro">assert_eq!</span>(loaded_payments, payments);

    <span class="comment">// the async fn returns Result, so
    </span><span class="prelude-val">Ok</span>(())
}</code></pre></div>
<h2 id="pool"><a class="doc-anchor" href="#pool">§</a>Pool</h2>
<p>The <a href="struct.Pool.html" title="struct mysql_async::Pool"><code>Pool</code></a> structure is an asynchronous connection pool.</p>
<p>Please note:</p>
<ul>
<li><a href="struct.Pool.html" title="struct mysql_async::Pool"><code>Pool</code></a> is a smart pointer – each clone will point to the same pool instance.</li>
<li><a href="struct.Pool.html" title="struct mysql_async::Pool"><code>Pool</code></a> is <code>Send + Sync + 'static</code> – feel free to pass it around.</li>
<li>use <a href="struct.Pool.html#method.disconnect" title="method mysql_async::Pool::disconnect"><code>Pool::disconnect</code></a> to gracefuly close the pool.</li>
<li>⚠️ <a href="struct.Pool.html#method.new" title="associated function mysql_async::Pool::new"><code>Pool::new</code></a> is lazy and won’t assert server availability.</li>
</ul>
<h2 id="transaction"><a class="doc-anchor" href="#transaction">§</a>Transaction</h2>
<p><a href="struct.Conn.html#method.start_transaction" title="method mysql_async::Conn::start_transaction"><code>Conn::start_transaction</code></a> is a wrapper, that starts with <code>START TRANSACTION</code>
and ends with <code>COMMIT</code> or <code>ROLLBACK</code>.</p>
<p>Dropped transaction will be implicitly rolled back if it wasn’t explicitly
committed or rolled back. Note that this behaviour will be triggered by a pool
(on conn drop) or by the next query, i.e. may be delayed.</p>
<p>API won’t allow you to run nested transactions because some statements causes
an implicit commit (<code>START TRANSACTION</code> is one of them), so this behavior
is chosen as less error prone.</p>
<h2 id="value"><a class="doc-anchor" href="#value">§</a><code>Value</code></h2>
<p>This enumeration represents the raw value of a MySql cell. Library offers conversion between
<code>Value</code> and different rust types via <code>FromValue</code> trait described below.</p>
<h3 id="fromvalue-trait"><a class="doc-anchor" href="#fromvalue-trait">§</a><code>FromValue</code> trait</h3>
<p>This trait is reexported from <strong>mysql_common</strong> create. Please refer to its
<a href="https://docs.rs/mysql_common">crate docs</a> for the list of supported conversions.</p>
<p>Trait offers conversion in two flavours:</p>
<ul>
<li>
<p><code>from_value(Value) -&gt; T</code> - convenient, but panicking conversion.</p>
<p>Note, that for any variant of <code>Value</code> there exist a type, that fully covers its domain,
i.e. for any variant of <code>Value</code> there exist <code>T: FromValue</code> such that <code>from_value</code> will never
panic. This means, that if your database schema is known, than it’s possible to write your
application using only <code>from_value</code> with no fear of runtime panic.</p>
<p>Also note, that some convertions may fail even though the type seem sufficient,
e.g. in case of invalid dates (see <a href="https://dev.mysql.com/doc/refman/8.0/en/sql-mode.html">sql mode</a>).</p>
</li>
<li>
<p><code>from_value_opt(Value) -&gt; Option&lt;T&gt;</code> - non-panicking, but less convenient conversion.</p>
<p>This function is useful to probe conversion in cases, where source database schema
is unknown.</p>
</li>
</ul>
<h2 id="mysql-query-protocols"><a class="doc-anchor" href="#mysql-query-protocols">§</a>MySql query protocols</h2><h3 id="text-protocol"><a class="doc-anchor" href="#text-protocol">§</a>Text protocol</h3>
<p>MySql text protocol is implemented in the set of <code>Queryable::query*</code> methods
and in the <a href="prelude/trait.Query.html" title="trait mysql_async::prelude::Query"><code>prelude::Query</code></a> trait if query is <a href="prelude/trait.AsQuery.html" title="trait mysql_async::prelude::AsQuery"><code>prelude::AsQuery</code></a>.
It’s useful when your query doesn’t have parameters.</p>
<p><strong>Note:</strong> All values of a text protocol result set will be encoded as strings by the server,
so <code>from_value</code> conversion may lead to additional parsing costs.</p>
<h3 id="binary-protocol-and-prepared-statements"><a class="doc-anchor" href="#binary-protocol-and-prepared-statements">§</a>Binary protocol and prepared statements.</h3>
<p>MySql binary protocol is implemented in the set of <code>exec*</code> methods,
defined on the <a href="prelude/trait.Queryable.html" title="trait mysql_async::prelude::Queryable"><code>prelude::Queryable</code></a> trait and in the <a href="prelude/trait.Query.html" title="trait mysql_async::prelude::Query"><code>prelude::Query</code></a>
trait if query is <a href="struct.QueryWithParams.html" title="struct mysql_async::QueryWithParams"><code>QueryWithParams</code></a>. Prepared statements is the only way to
pass rust value to the MySql server. MySql uses <code>?</code> symbol as a parameter placeholder.</p>
<p><strong>Note:</strong> it’s only possible to use parameters where a single MySql value
is expected, i.e. you can’t execute something like <code>SELECT ... WHERE id IN ?</code>
with a vector as a parameter. You’ll need to build a query that looks like
<code>SELECT ... WHERE id IN (?, ?, ...)</code> and to pass each vector element as
a parameter.</p>
<h2 id="named-parameters"><a class="doc-anchor" href="#named-parameters">§</a>Named parameters</h2>
<p>MySql itself doesn’t have named parameters support, so it’s implemented on the client side.
One should use <code>:name</code> as a placeholder syntax for a named parameter. Named parameters uses
the following naming convention:</p>
<ul>
<li>parameter name must start with either <code>_</code> or <code>a..z</code></li>
<li>parameter name may continue with <code>_</code>, <code>a..z</code> and <code>0..9</code></li>
</ul>
<p><strong>Note:</strong> this rules mean that, say, the statment <code>SELECT :fooBar</code> will be translated
to <code>SELECT ?Bar</code> so please be careful.</p>
<p>Named parameters may be repeated within the statement, e.g <code>SELECT :foo, :foo</code> will require
a single named parameter <code>foo</code> that will be repeated on the corresponding positions during
statement execution.</p>
<p>One should use the <code>params!</code> macro to build parameters for execution.</p>
<p><strong>Note:</strong> Positional and named parameters can’t be mixed within the single statement.</p>
<h2 id="statements"><a class="doc-anchor" href="#statements">§</a>Statements</h2>
<p>In MySql each prepared statement belongs to a particular connection and can’t be executed
on another connection. Trying to do so will lead to an error. The driver won’t tie statement
to its connection in any way, but one can look on to the connection id, contained
in the <a href="struct.Statement.html" title="struct mysql_async::Statement"><code>Statement</code></a> structure.</p>
<h2 id="local-infile-handlers"><a class="doc-anchor" href="#local-infile-handlers">§</a>LOCAL INFILE Handlers</h2>
<p><strong>Warning:</strong> You should be aware of <a href="https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html">Security Considerations for LOAD DATA LOCAL</a>.</p>
<p>There are two flavors of LOCAL INFILE handlers – <em>global</em> and <em>local</em>.</p>
<p>I case of a LOCAL INFILE request from the server the driver will try to find a handler for it:</p>
<ol>
<li>It’ll try to use <em>local</em> handler installed on the connection, if any;</li>
<li>It’ll try to use <em>global</em> handler, specified via <a href="struct.OptsBuilder.html#method.local_infile_handler" title="method mysql_async::OptsBuilder::local_infile_handler"><code>OptsBuilder::local_infile_handler</code></a>,
if any;</li>
<li>It will emit <a href="enum.LocalInfileError.html#variant.NoHandler" title="variant mysql_async::LocalInfileError::NoHandler"><code>LocalInfileError::NoHandler</code></a> if no handlers found.</li>
</ol>
<p>The purpose of a handler (<em>local</em> or <em>global</em>) is to return <a href="type.InfileData.html" title="type mysql_async::InfileData"><code>InfileData</code></a>.</p>
<h3 id="global-local-infile-handler"><a class="doc-anchor" href="#global-local-infile-handler">§</a><em>Global</em> LOCAL INFILE handler</h3>
<p>See <a href="prelude/trait.GlobalHandler.html" title="trait mysql_async::prelude::GlobalHandler"><code>prelude::GlobalHandler</code></a>.</p>
<p>Simply speaking the <em>global</em> handler is an async function that takes a file name (as <code>&amp;[u8]</code>)
and returns <code>Result&lt;InfileData&gt;</code>.</p>
<p>You can set it up using <a href="struct.OptsBuilder.html#method.local_infile_handler" title="method mysql_async::OptsBuilder::local_infile_handler"><code>OptsBuilder::local_infile_handler</code></a>. Server will use it if there is no
<em>local</em> handler installed for the connection. This handler might be called multiple times.</p>
<p>Examles:</p>
<ol>
<li><a href="struct.WhiteListFsHandler.html" title="struct mysql_async::WhiteListFsHandler"><code>WhiteListFsHandler</code></a> is a <em>global</em> handler.</li>
<li>Every <code>T: Fn(&amp;[u8]) -&gt; BoxFuture&lt;'static, Result&lt;InfileData, LocalInfileError&gt;&gt;</code>
is a <em>global</em> handler.</li>
</ol>
<h3 id="local-local-infile-handler"><a class="doc-anchor" href="#local-local-infile-handler">§</a><em>Local</em> LOCAL INFILE handler.</h3>
<p>Simply speaking the <em>local</em> handler is a future, that returns <code>Result&lt;InfileData&gt;</code>.</p>
<p>This is a one-time handler – it’s consumed after use. You can set it up using
<a href="struct.Conn.html#method.set_infile_handler" title="method mysql_async::Conn::set_infile_handler"><code>Conn::set_infile_handler</code></a>. This handler have priority over <em>global</em> handler.</p>
<p>Worth noting:</p>
<ol>
<li><code>impl Drop for Conn</code> will clear <em>local</em> handler, i.e. handler will be removed when
connection is returned to a <code>Pool</code>.</li>
<li><a href="struct.Conn.html#method.reset" title="method mysql_async::Conn::reset"><code>Conn::reset</code></a> will clear <em>local</em> handler.</li>
</ol>
<p>Example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>pool = mysql_async::Pool::new(database_url);

<span class="kw">let </span><span class="kw-2">mut </span>conn = pool.get_conn().<span class="kw">await</span><span class="question-mark">?</span>;
<span class="string">"CREATE TEMPORARY TABLE tmp (id INT, val TEXT)"</span>.ignore(<span class="kw-2">&amp;mut </span>conn).<span class="kw">await</span><span class="question-mark">?</span>;

<span class="comment">// We are going to call `LOAD DATA LOCAL` so let's setup a one-time handler.
</span>conn.set_infile_handler(<span class="kw">async move </span>{
    <span class="comment">// We need to return a stream of `io::Result&lt;Bytes&gt;`
    </span><span class="prelude-val">Ok</span>(stream::iter([Bytes::from(<span class="string">"1,a\r\n"</span>), Bytes::from(<span class="string">"2,b\r\n3,c"</span>)]).map(<span class="prelude-val">Ok</span>).boxed())
});

<span class="kw">let </span>result = <span class="string">r#"LOAD DATA LOCAL INFILE 'whatever'
    INTO TABLE `tmp`
    FIELDS TERMINATED BY ',' ENCLOSED BY '\"'
    LINES TERMINATED BY '\r\n'"#</span>.ignore(<span class="kw-2">&amp;mut </span>conn).<span class="kw">await</span>;

<span class="kw">match </span>result {
    <span class="prelude-val">Ok</span>(()) =&gt; (),
    <span class="prelude-val">Err</span>(Error::Server(<span class="kw-2">ref </span>err)) <span class="kw">if </span>err.code == <span class="number">1148 </span>=&gt; {
        <span class="comment">// The used command is not allowed with this MySQL version
        </span><span class="kw">return </span><span class="prelude-val">Ok</span>(());
    },
    <span class="prelude-val">Err</span>(Error::Server(<span class="kw-2">ref </span>err)) <span class="kw">if </span>err.code == <span class="number">3948 </span>=&gt; {
        <span class="comment">// Loading local data is disabled;
        // this must be enabled on both the client and the server
        </span><span class="kw">return </span><span class="prelude-val">Ok</span>(());
    }
    e @ <span class="prelude-val">Err</span>(<span class="kw">_</span>) =&gt; e.unwrap(),
}

<span class="comment">// Now let's verify the result
</span><span class="kw">let </span>result: Vec&lt;(u32, String)&gt; = conn.query(<span class="string">"SELECT * FROM tmp ORDER BY id ASC"</span>).<span class="kw">await</span><span class="question-mark">?</span>;
<span class="macro">assert_eq!</span>(
    result,
    <span class="macro">vec!</span>[(<span class="number">1</span>, <span class="string">"a"</span>.into()), (<span class="number">2</span>, <span class="string">"b"</span>.into()), (<span class="number">3</span>, <span class="string">"c"</span>.into())]
);

drop(conn);
pool.disconnect().<span class="kw">await</span><span class="question-mark">?</span>;</code></pre></div>
<h2 id="testing"><a class="doc-anchor" href="#testing">§</a>Testing</h2>
<p>Tests uses followin environment variables:</p>
<ul>
<li><code>DATABASE_URL</code> – defaults to <code>mysql://root:password@127.0.0.1:3307/mysql</code></li>
<li><code>COMPRESS</code> – set to <code>1</code> or <code>true</code> to enable compression for tests</li>
<li><code>SSL</code> – set to <code>1</code> or <code>true</code> to enable TLS for tests</li>
</ul>
<p>You can run a test server using doker. Please note that params related
to max allowed packet, local-infile and binary logging are required
to properly run tests (please refer to <code>azure-pipelines.yml</code>):</p>
<div class="example-wrap"><pre class="language-sh"><code>docker run -d --name container \
    -v `pwd`:/root \
    -p 3307:3306 \
    -e MYSQL_ROOT_PASSWORD=password \
    mysql:8.0 \
    --max-allowed-packet=36700160 \
    --local-infile \
    --log-bin=mysql-bin \
    --log-slave-updates \
    --gtid_mode=ON \
    --enforce_gtid_consistency=ON \
    --server-id=1</code></pre></div></div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="binlog/index.html" title="mod mysql_async::binlog">binlog</a></div></li><li><div class="item-name"><a class="mod" href="consts/index.html" title="mod mysql_async::consts">consts</a></div></li><li><div class="item-name"><a class="mod" href="futures/index.html" title="mod mysql_async::futures">futures</a></div><div class="desc docblock-short">Futures used in this crate</div></li><li><div class="item-name"><a class="mod" href="params/index.html" title="mod mysql_async::params">params</a></div></li><li><div class="item-name"><a class="mod" href="prelude/index.html" title="mod mysql_async::prelude">prelude</a></div><div class="desc docblock-short">Traits used in this crate</div></li></ul><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.params.html" title="macro mysql_async::params">params</a></div><div class="desc docblock-short">This macro is a convenient way to pass named parameters to a statement.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BinaryProtocol.html" title="struct mysql_async::BinaryProtocol">Binary<wbr>Protocol</a></div><div class="desc docblock-short">Phantom struct used to specify MySql binary protocol.</div></li><li><div class="item-name"><a class="struct" href="struct.BinlogStream.html" title="struct mysql_async::BinlogStream">Binlog<wbr>Stream</a></div><div class="desc docblock-short">Binlog event stream.</div></li><li><div class="item-name"><a class="struct" href="struct.BinlogStreamRequest.html" title="struct mysql_async::BinlogStreamRequest">Binlog<wbr>Stream<wbr>Request</a></div><div class="desc docblock-short">Binlog stream request builder.</div></li><li><div class="item-name"><a class="struct" href="struct.ChangeUserOpts.html" title="struct mysql_async::ChangeUserOpts">Change<wbr>User<wbr>Opts</a></div><div class="desc docblock-short"><a href="https://dev.mysql.com/doc/c-api/5.7/en/mysql-change-user.html"><code>COM_CHANGE_USER</code></a> options.</div></li><li><div class="item-name"><a class="struct" href="struct.ClientIdentity.html" title="struct mysql_async::ClientIdentity">Client<wbr>Identity</a></div></li><li><div class="item-name"><a class="struct" href="struct.Column.html" title="struct mysql_async::Column">Column</a></div><div class="desc docblock-short">Represents MySql Column (column packet).</div></li><li><div class="item-name"><a class="struct" href="struct.Compression.html" title="struct mysql_async::Compression">Compression</a></div><div class="desc docblock-short">When compressing data, the compression level can be specified by a value in
this struct.</div></li><li><div class="item-name"><a class="struct" href="struct.Conn.html" title="struct mysql_async::Conn">Conn</a></div><div class="desc docblock-short">MySql server connection.</div></li><li><div class="item-name"><a class="struct" href="struct.Deserialized.html" title="struct mysql_async::Deserialized">Deserialized</a></div><div class="desc docblock-short">Use it to parse <code>T: Deserialize</code> from <code>Value</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.FromRowError.html" title="struct mysql_async::FromRowError">From<wbr>RowError</a></div><div class="desc docblock-short"><code>FromRow</code> conversion error.</div></li><li><div class="item-name"><a class="struct" href="struct.FromValueError.html" title="struct mysql_async::FromValueError">From<wbr>Value<wbr>Error</a></div><div class="desc docblock-short"><code>FromValue</code> conversion error.</div></li><li><div class="item-name"><a class="struct" href="struct.GnoInterval.html" title="struct mysql_async::GnoInterval">GnoInterval</a></div><div class="desc docblock-short">GnoInterval. Stored within <a href="struct.Sid.html" title="struct mysql_async::Sid"><code>Sid</code></a></div></li><li><div class="item-name"><a class="struct" href="struct.Gtids.html" title="struct mysql_async::Gtids">Gtids</a></div><div class="desc docblock-short">This tracker type indicates that GTIDs are available and contains the GTID string.</div></li><li><div class="item-name"><a class="struct" href="struct.OkPacket.html" title="struct mysql_async::OkPacket">OkPacket</a></div><div class="desc docblock-short">Represents MySql’s Ok packet.</div></li><li><div class="item-name"><a class="struct" href="struct.Opts.html" title="struct mysql_async::Opts">Opts</a></div><div class="desc docblock-short">Mysql connection options.</div></li><li><div class="item-name"><a class="struct" href="struct.OptsBuilder.html" title="struct mysql_async::OptsBuilder">Opts<wbr>Builder</a></div><div class="desc docblock-short">Provides a way to build <a href="struct.Opts.html" title="struct mysql_async::Opts"><code>Opts</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.Pool.html" title="struct mysql_async::Pool">Pool</a></div><div class="desc docblock-short">Asynchronous pool of MySql connections.</div></li><li><div class="item-name"><a class="struct" href="struct.PoolConstraints.html" title="struct mysql_async::PoolConstraints">Pool<wbr>Constraints</a></div><div class="desc docblock-short">Connection pool constraints.</div></li><li><div class="item-name"><a class="struct" href="struct.PoolOpts.html" title="struct mysql_async::PoolOpts">Pool<wbr>Opts</a></div><div class="desc docblock-short">Connection pool options.</div></li><li><div class="item-name"><a class="struct" href="struct.QueryResult.html" title="struct mysql_async::QueryResult">Query<wbr>Result</a></div><div class="desc docblock-short">Result of a query or statement execution.</div></li><li><div class="item-name"><a class="struct" href="struct.QueryWithParams.html" title="struct mysql_async::QueryWithParams">Query<wbr>With<wbr>Params</a></div><div class="desc docblock-short">Representation of a prepared statement query.</div></li><li><div class="item-name"><a class="struct" href="struct.ResultSetStream.html" title="struct mysql_async::ResultSetStream">Result<wbr>SetStream</a></div><div class="desc docblock-short">Rows stream for a single result set.</div></li><li><div class="item-name"><a class="struct" href="struct.Row.html" title="struct mysql_async::Row">Row</a></div><div class="desc docblock-short">Client side representation of a MySql row.</div></li><li><div class="item-name"><a class="struct" href="struct.Schema.html" title="struct mysql_async::Schema">Schema</a></div><div class="desc docblock-short">This tracker type indicates that the default schema has been set.</div></li><li><div class="item-name"><a class="struct" href="struct.Serialized.html" title="struct mysql_async::Serialized">Serialized</a></div><div class="desc docblock-short">Use it to pass <code>T: Serialize</code> as JSON to a prepared statement.</div></li><li><div class="item-name"><a class="struct" href="struct.ServerError.html" title="struct mysql_async::ServerError">Server<wbr>Error</a></div><div class="desc docblock-short">This type represents MySql server error.</div></li><li><div class="item-name"><a class="struct" href="struct.SessionStateInfo.html" title="struct mysql_async::SessionStateInfo">Session<wbr>State<wbr>Info</a></div><div class="desc docblock-short">Represents change in session state (part of MySql’s Ok packet).</div></li><li><div class="item-name"><a class="struct" href="struct.Sid.html" title="struct mysql_async::Sid">Sid</a></div><div class="desc docblock-short">SID is a part of the <code>COM_BINLOG_DUMP_GTID</code> command. It’s a GtidSet whose
has only one Uuid.</div></li><li><div class="item-name"><a class="struct" href="struct.SslOpts.html" title="struct mysql_async::SslOpts">SslOpts</a></div><div class="desc docblock-short">Ssl Options.</div></li><li><div class="item-name"><a class="struct" href="struct.Statement.html" title="struct mysql_async::Statement">Statement</a></div><div class="desc docblock-short">Prepared statement.</div></li><li><div class="item-name"><a class="struct" href="struct.SystemVariable.html" title="struct mysql_async::SystemVariable">System<wbr>Variable</a></div><div class="desc docblock-short">This tracker type indicates that one or more tracked session
system variables have been assigned a value.</div></li><li><div class="item-name"><a class="struct" href="struct.TextProtocol.html" title="struct mysql_async::TextProtocol">Text<wbr>Protocol</a></div><div class="desc docblock-short">Phantom struct used to specify MySql text protocol.</div></li><li><div class="item-name"><a class="struct" href="struct.Transaction.html" title="struct mysql_async::Transaction">Transaction</a></div><div class="desc docblock-short">This struct represents MySql transaction.</div></li><li><div class="item-name"><a class="struct" href="struct.TransactionCharacteristics.html" title="struct mysql_async::TransactionCharacteristics">Transaction<wbr>Characteristics</a></div><div class="desc docblock-short">This tracker type indicates that transaction characteristics are available.</div></li><li><div class="item-name"><a class="struct" href="struct.TransactionState.html" title="struct mysql_async::TransactionState">Transaction<wbr>State</a></div><div class="desc docblock-short">This tracker type indicates that transaction state information is available.</div></li><li><div class="item-name"><a class="struct" href="struct.TxOpts.html" title="struct mysql_async::TxOpts">TxOpts</a></div><div class="desc docblock-short">Transaction options.</div></li><li><div class="item-name"><a class="struct" href="struct.Unsupported.html" title="struct mysql_async::Unsupported">Unsupported</a></div><div class="desc docblock-short">This tracker type is unknown/unsupported.</div></li><li><div class="item-name"><a class="struct" href="struct.WhiteListFsHandler.html" title="struct mysql_async::WhiteListFsHandler">White<wbr>List<wbr>FsHandler</a></div><div class="desc docblock-short">Handles <code>LOCAL INFILE</code> requests from filesystem using an explicit whitelist of paths.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.DriverError.html" title="enum mysql_async::DriverError">Driver<wbr>Error</a></div><div class="desc docblock-short">This type enumerates driver errors.</div></li><li><div class="item-name"><a class="enum" href="enum.Error.html" title="enum mysql_async::Error">Error</a></div><div class="desc docblock-short">This type enumerates library errors.</div></li><li><div class="item-name"><a class="enum" href="enum.IoError.html" title="enum mysql_async::IoError">IoError</a></div><div class="desc docblock-short">This type enumerates IO errors.</div></li><li><div class="item-name"><a class="enum" href="enum.IsolationLevel.html" title="enum mysql_async::IsolationLevel">Isolation<wbr>Level</a></div><div class="desc docblock-short">Transaction isolation level.</div></li><li><div class="item-name"><a class="enum" href="enum.LocalInfileError.html" title="enum mysql_async::LocalInfileError">Local<wbr>Infile<wbr>Error</a></div></li><li><div class="item-name"><a class="enum" href="enum.Params.html" title="enum mysql_async::Params">Params</a></div><div class="desc docblock-short">Representations of parameters of a prepared statement.</div></li><li><div class="item-name"><a class="enum" href="enum.ParseError.html" title="enum mysql_async::ParseError">Parse<wbr>Error</a></div><div class="desc docblock-short">Errors that can occur during parsing.</div></li><li><div class="item-name"><a class="enum" href="enum.SessionStateChange.html" title="enum mysql_async::SessionStateChange">Session<wbr>State<wbr>Change</a></div><div class="desc docblock-short">Represents a parsed change in a session state (part of MySql’s Ok packet).</div></li><li><div class="item-name"><a class="enum" href="enum.TlsError.html" title="enum mysql_async::TlsError">TlsError</a></div></li><li><div class="item-name"><a class="enum" href="enum.UrlError.html" title="enum mysql_async::UrlError">UrlError</a></div><div class="desc docblock-short">This type enumerates connection URL errors.</div></li><li><div class="item-name"><a class="enum" href="enum.Value.html" title="enum mysql_async::Value">Value</a></div><div class="desc docblock-short">Client side representation of a value of MySql column.</div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.DEFAULT_INACTIVE_CONNECTION_TTL.html" title="constant mysql_async::DEFAULT_INACTIVE_CONNECTION_TTL">DEFAULT_<wbr>INACTIVE_<wbr>CONNECTION_<wbr>TTL</a></div><div class="desc docblock-short">Default <code>inactive_connection_ttl</code> of a pool.</div></li><li><div class="item-name"><a class="constant" href="constant.DEFAULT_POOL_CONSTRAINTS.html" title="constant mysql_async::DEFAULT_POOL_CONSTRAINTS">DEFAULT_<wbr>POOL_<wbr>CONSTRAINTS</a></div><div class="desc docblock-short">Default pool constraints.</div></li><li><div class="item-name"><a class="constant" href="constant.DEFAULT_STMT_CACHE_SIZE.html" title="constant mysql_async::DEFAULT_STMT_CACHE_SIZE">DEFAULT_<wbr>STMT_<wbr>CACHE_<wbr>SIZE</a></div><div class="desc docblock-short">Each connection will cache up to this number of statements by default.</div></li><li><div class="item-name"><a class="constant" href="constant.DEFAULT_TTL_CHECK_INTERVAL.html" title="constant mysql_async::DEFAULT_TTL_CHECK_INTERVAL">DEFAULT_<wbr>TTL_<wbr>CHECK_<wbr>INTERVAL</a></div><div class="desc docblock-short">Default <code>ttl_check_interval</code> of a pool.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.from_row.html" title="fn mysql_async::from_row">from_<wbr>row</a></div><div class="desc docblock-short">Will <em>panic</em> if could not convert <code>row</code> to <code>T</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.from_row_opt.html" title="fn mysql_async::from_row_opt">from_<wbr>row_<wbr>opt</a></div><div class="desc docblock-short">Will return <code>Err(row)</code> if could not convert <code>row</code> to <code>T</code></div></li><li><div class="item-name"><a class="fn" href="fn.from_value.html" title="fn mysql_async::from_value">from_<wbr>value</a></div><div class="desc docblock-short">Will panic if could not convert <code>v</code> to <code>T</code></div></li><li><div class="item-name"><a class="fn" href="fn.from_value_opt.html" title="fn mysql_async::from_value_opt">from_<wbr>value_<wbr>opt</a></div><div class="desc docblock-short">Will return <code>Err(FromValueError(v))</code> if could not convert <code>v</code> to <code>T</code></div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.InfileData.html" title="type mysql_async::InfileData">Infile<wbr>Data</a></div><div class="desc docblock-short">LOCAL INFILE data is a stream of <code>std::io::Result&lt;Bytes&gt;</code>.</div></li><li><div class="item-name"><a class="type" href="type.Result.html" title="type mysql_async::Result">Result</a></div><div class="desc docblock-short">Result type alias for this library.</div></li></ul></section></div></main></body></html>